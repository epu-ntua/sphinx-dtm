{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": 23,
  "iteration": 1647517880896,
  "links": [],
  "panels": [
    {
      "datasource": null,
      "description": "",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "id": 17,
      "options": {
        "content": "<script type=\"text/javascript\" language=\"javascript\">\r\nfunction goToPage() {\r\n    window.open('https://polaris.146.124.106.181.nip.io/id-ui/ad?ticket=' + window.localStorage.getItem('sphinx_sm_ticket') || '');\r\n}\r\n</script>\r\n<div style=\"padding-top: 20px;\">\r\n    <p style=\"font-size: 35px; text-align: center;\"><b style=\"color: #00a79d;\">SPHINX</b> - Anomaly Detection</p>\r\n    <hr>\r\n    <div style=\"text-align: center;\">\r\n    <a href=\"/interactive-dashboards/public/manuals/with_dashboards/AD/AD_DASHBOARD_MANUAL.pdf\" target=\"_blank\" style=\"background-color: teal; border: none; color white; padding: 15px 32px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; cursor: pointer; margin: 4px 2px; color: white;\">\r\n    <img class=\"valign\" src=\"/interactive-dashboards/public/img/pdf.png\" width=\"24px\" height=\"19px\"> Dashboard manual</a>\r\n    <a href=\"/interactive-dashboards/public/manuals/with_dashboards/AD/AD_COMPONENT_MANUAL.pdf\" target=\"_blank\" style=\"background-color: teal; border: none; color white; padding: 15px 32px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; cursor: pointer; margin: 4px 2px; color: white;\">\r\n    <img class=\"valign\" src=\"/interactive-dashboards/public/img/pdf.png\" width=\"24px\" height=\"19px\"> Component manual</a>\r\n    <div onclick=\"goToPage()\"  style=\"background-color: teal; border: none; color white; padding: 15px 32px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; cursor: pointer; margin: 4px 2px; color: white;\">\r\n    AD Webpage\r\n    </div>\r\n    </div>\r\n</div>",
        "mode": "html"
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "bucketAggs": [
            {
              "$$hashKey": "object:437",
              "field": "@timestamp",
              "id": "2",
              "settings": {
                "interval": "auto",
                "min_doc_count": 0,
                "trimEdges": 0
              },
              "type": "date_histogram"
            }
          ],
          "metrics": [
            {
              "$$hashKey": "object:435",
              "field": "select field",
              "id": "1",
              "type": "count"
            }
          ],
          "refId": "A",
          "timeField": "@timestamp"
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "",
      "transparent": true,
      "type": "text"
    },
    {
      "datasource": null,
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 19,
      "options": {
        "content": "\n<h2>Short description</h2>\n<p style=\"text-align: justify\">Anomaly Detection is a SPHINX component that raises alerts when anomalous or suspicious activities are detected. AD does not use the raw network data. AD uses as input the logs generated by Data Traffic Monitoring component. </p>\n<hr/>\n<h2>Objectives</h2>\n<ul style=\"list-style-type: none; padding: 0; margin: 0;\">\n  <li style=\"margin-top: -1px; padding: 12px;\"><span style=\"color: green;font-size:20px;font-weight:bold;\">*</span> Detect anomalous activities</li>\n  <li style=\"margin-top: -1px; padding: 12px;\"><span style=\"color: green;font-size:20px;font-weight:bold;\">*</span> Analyse HTTP & DNS Traffic with k-means algorithm</li>\n  <li style=\"margin-top: -1px; padding: 12px;\"><span style=\"color: green;font-size:20px;font-weight:bold;\">*</span> Identify issues (SMTP, UDP, P2P, etc.) with statistical algorithms</li>\n</ul>\n",
        "mode": "html"
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "queryType": "randomWalk",
          "refId": "A"
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Functionalities",
      "transparent": true,
      "type": "text"
    },
    {
      "datasource": null,
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "gridPos": {
        "h": 3,
        "w": 24,
        "x": 0,
        "y": 6
      },
      "id": 4,
      "options": {
        "content": "<h1 style=\"background-color: #00a79d; color: white; padding: 20px\"> Alerts </h1>",
        "mode": "html"
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "queryType": "randomWalk",
          "refId": "A"
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "",
      "transparent": true,
      "type": "text"
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 0,
        "y": 9
      },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "mean"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) FROM sphinx.\"kafka_AD_ALERT_AVRO\"  where DATE(\"TIMESTAMP\") >= CURRENT_DATE AND DATE(\"TIMESTAMP\") < CURRENT_DATE + INTERVAL '1 DAY' AND \"ALGORITHMTYPE\" = ANY(ARRAY[$Algorithm_type]::varchar[]);",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "\"ID\""
                ],
                "type": "column"
              }
            ]
          ],
          "table": "\"kafka_AD_ALERTS\"",
          "timeColumn": "\"ID\"",
          "timeColumnType": "int8",
          "where": [
            {
              "name": "$__unixEpochFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Number of alerts today",
      "type": "stat"
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 4,
        "y": 9
      },
      "id": 8,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "mean"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) FROM sphinx.\"kafka_AD_ALERT_AVRO\" where DATE(\"TIMESTAMP\") = CURRENT_DATE - INTEGER '1' AND \"ALGORITHMTYPE\" = ANY(ARRAY[$Algorithm_type]::varchar[]);",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "\"ID\""
                ],
                "type": "column"
              }
            ]
          ],
          "table": "\"kafka_AD_ALERTS\"",
          "timeColumn": "\"ID\"",
          "timeColumnType": "int8",
          "where": [
            {
              "name": "$__unixEpochFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Number of alerts yesterday",
      "type": "stat"
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 8,
        "y": 9
      },
      "id": 9,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "mean"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) FROM sphinx.\"kafka_AD_ALERT_AVRO\" where DATE(\"TIMESTAMP\") = CURRENT_DATE - INTEGER '2' AND \"ALGORITHMTYPE\" = ANY(ARRAY[$Algorithm_type]::varchar[]);",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "\"ID\""
                ],
                "type": "column"
              }
            ]
          ],
          "table": "\"kafka_AD_ALERTS\"",
          "timeColumn": "\"ID\"",
          "timeColumnType": "int8",
          "where": [
            {
              "name": "$__unixEpochFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Number of alerts two days ago",
      "type": "stat"
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "PostgreSQL",
      "description": "",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fill": 2,
      "fillGradient": 0,
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 9
      },
      "hiddenSeries": false,
      "id": 7,
      "legend": {
        "alignAsTable": false,
        "avg": false,
        "current": false,
        "hideEmpty": false,
        "hideZero": false,
        "max": false,
        "min": false,
        "rightSide": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null",
      "options": {
        "alertThreshold": true
      },
      "percentage": false,
      "pluginVersion": "7.3.1",
      "pointradius": 4,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "format": "table",
          "group": [
            {
              "params": [
                "$__interval",
                "none"
              ],
              "type": "time"
            }
          ],
          "metricColumn": "\"ALGORITHMBYTESDOWN\"",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*), DATE(\"TIMESTAMP\")::date as time FROM sphinx.\"kafka_AD_ALERT_AVRO\" \nWHERE extract(EPOCH from \"TIMESTAMP\"::timestamp) BETWEEN ${__from:date:seconds} AND ${__to:date:seconds}\nAND \"ALGORITHMTYPE\" = ANY(ARRAY[$Algorithm_type]::varchar[]) GROUP BY (time) ORDER BY time DESC;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "\"ID\""
                ],
                "type": "column"
              },
              {
                "params": [
                  "avg"
                ],
                "type": "aggregate"
              },
              {
                "params": [
                  "\"ID\""
                ],
                "type": "alias"
              }
            ]
          ],
          "table": "\"kafka_AD_ALERTS\"",
          "timeColumn": "DATE(\"TIMESTAMP\")::date",
          "timeColumnType": "text",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [
        {
          "$$hashKey": "object:421",
          "colorMode": "background6",
          "fill": true,
          "fillColor": "rgba(234, 112, 112, 0.12)",
          "line": false,
          "lineColor": "rgba(237, 46, 24, 0.60)",
          "op": "time"
        }
      ],
      "timeShift": null,
      "title": "Number of alerts per day",
      "tooltip": {
        "shared": true,
        "sort": 1,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "$$hashKey": "object:363",
          "format": "short",
          "label": "No. of alerts",
          "logBase": 1,
          "max": null,
          "min": "0",
          "show": true
        },
        {
          "$$hashKey": "object:364",
          "format": "short",
          "label": "Time",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "left",
            "displayMode": "json-view",
            "filterable": true
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 15
      },
      "id": 11,
      "options": {
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT \"ALERTID\" AS \"STIX ID\", \"TIMESTAMP\" AS \"Timestamp\", \"TITLE\" AS \"Description\", \"TEXT\" AS \"Details\", \"ALGORITHMSTRINGFLOWS\" AS \"Info\", \"ALGORITHMMYIP\" AS \"IP\", \"ALGORITHMPORTS\" AS \"Ports\", \"FLOWID\" AS \"Flow ID\" FROM sphinx.\"kafka_AD_ALERT_AVRO\" WHERE \"ALGORITHMTYPE\" = ANY(ARRAY[$Algorithm_type]::varchar[])\nAND \"TIMESTAMP\"::timestamp BETWEEN to_timestamp(${__from:date:seconds}) AND to_timestamp(${__to:date:seconds})\nLIMIT 100;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Short Logs",
      "type": "table"
    },
    {
      "datasource": "PostgreSQL",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": null,
            "filterable": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 23
      },
      "id": 20,
      "options": {
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "7.3.1",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT * FROM sphinx.\"kafka_AD_ALERT_AVRO\" WHERE \"ALGORITHMTYPE\" = ANY(ARRAY[$Algorithm_type]::varchar[])\nAND \"TIMESTAMP\"::timestamp BETWEEN to_timestamp(${__from:date:seconds}) AND to_timestamp(${__to:date:seconds})\nLIMIT 100;",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "timeFrom": null,
      "timeShift": null,
      "title": "Logs",
      "type": "table"
    }
  ],
  "refresh": false,
  "schemaVersion": 26,
  "style": "dark",
  "tags": [
    "AD",
    "Anomaly Detection"
  ],
  "templating": {
    "list": [
      {
        "allValue": null,
        "current": {
          "selected": true,
          "tags": [],
          "text": [
            "All"
          ],
          "value": [
            "$__all"
          ]
        },
        "error": null,
        "hide": 0,
        "includeAll": true,
        "label": "Algorithm Type",
        "multi": true,
        "name": "Algorithm_type",
        "options": [
          {
            "selected": false,
            "text": "All",
            "value": "$__all"
          },
          {
            "selected": false,
            "text": "VerticalPortScan_sflow",
            "value": "VerticalPortScan_sflow"
          },
          {
            "selected": false,
            "text": "UDPAmplifier_sflow",
            "value": "UDPAmplifier_sflow"
          },
          {
            "selected": false,
            "text": "SMTPTalker_sflow",
            "value": "SMTPTalker_sflow"
          },
          {
            "selected": false,
            "text": "P2PCommunication_sflow",
            "value": "P2PCommunication_sflow"
          },
          {
            "selected": false,
            "text": "MediaStreamingClient_sflow",
            "value": "MediaStreamingClient_sflow"
          },
          {
            "selected": false,
            "text": "ICMPTunnel_sflow",
            "value": "ICMPTunnel_sflow"
          },
          {
            "selected": false,
            "text": "HorizontalPortScan_sflow",
            "value": "HorizontalPortScan_sflow"
          },
          {
            "selected": false,
            "text": "DnsTunnel_sflow",
            "value": "DnsTunnel_sflow"
          },
          {
            "selected": false,
            "text": "CCBotNet_sflow",
            "value": "CCBotNet_sflow"
          },
          {
            "selected": false,
            "text": "AtypicalTCPPortUsed_sflow",
            "value": "AtypicalTCPPortUsed_sflow"
          },
          {
            "selected": false,
            "text": "AtypicalNumberOfPairs_sflow",
            "value": "AtypicalNumberOfPairs_sflow"
          },
          {
            "selected": false,
            "text": "AtypicalAmountData_sflow",
            "value": "AtypicalAmountData_sflow"
          },
          {
            "selected": false,
            "text": "AtypicalAlienTCPPortUsed_sflow",
            "value": "AtypicalAlienTCPPortUsed_sflow"
          },
          {
            "selected": false,
            "text": "AlienAccessingManyHosts_sflow",
            "value": "AlienAccessingManyHosts_sflow"
          },
          {
            "selected": false,
            "text": "AbusedSMTP_sflow",
            "value": "AbusedSMTP_sflow"
          }
        ],
        "query": "VerticalPortScan_sflow,UDPAmplifier_sflow,SMTPTalker_sflow,P2PCommunication_sflow,MediaStreamingClient_sflow,ICMPTunnel_sflow,HorizontalPortScan_sflow,DnsTunnel_sflow,CCBotNet_sflow,AtypicalTCPPortUsed_sflow,AtypicalNumberOfPairs_sflow,AtypicalAmountData_sflow,AtypicalAlienTCPPortUsed_sflow,AlienAccessingManyHosts_sflow,AbusedSMTP_sflow",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      }
    ]
  },
  "time": {
    "from": "2021-10-20T00:00:00.000Z",
    "to": "2021-10-28T00:00:00.000Z"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Anomaly Detection",
  "uid": "zT2o7c9Gz",
  "version": 2
}