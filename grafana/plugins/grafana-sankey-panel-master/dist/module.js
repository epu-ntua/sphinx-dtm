define(["jquery","lodash","app/plugins/sdk","app/core/utils/kbn","app/core/time_series","angular"],(function(e,t,n,i,r,o){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=11)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t,n){var i,r;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*!
 * perfect-scrollbar v1.2.0
 * (c) 2017 Hyunje Jun
 * @license MIT
 */!function(a,s){"object"==o(t)&&void 0!==e?e.exports=s():void 0===(r="function"==typeof(i=s)?i.call(t,n,t,e):i)||(e.exports=r)}(0,(function(){"use strict";function e(e){return getComputedStyle(e)}function t(e,t){for(var n in t){var i=t[n];"number"==typeof i&&(i+="px"),e.style[n]=i}return e}function n(e){var t=document.createElement("div");return t.className=e,t}function i(e,t){if(!f)throw new Error("No element matching method supported");return f.call(e,t)}function r(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e)}function o(e,t){return Array.prototype.filter.call(e.children,(function(e){return i(e,t)}))}function a(e,t){var n=e.element.classList,i=v.state.scrolling(t);n.contains(i)?clearTimeout(b[t]):n.add(i)}function s(e,t){b[t]=setTimeout((function(){return e.isAlive&&e.element.classList.remove(v.state.scrolling(t))}),e.settings.scrollingThreshold)}function l(e,t){a(e,t),s(e,t)}function c(e){if("function"==typeof window.CustomEvent)return new CustomEvent(e);var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,void 0),t}function d(e){return parseInt(e,10)||0}function h(e){return i(e,"input,[contenteditable]")||i(e,"select,[contenteditable]")||i(e,"textarea,[contenteditable]")||i(e,"button,[contenteditable]")}function u(e,t){return e.settings.minScrollbarLength&&(t=Math.max(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=Math.min(t,e.settings.maxScrollbarLength)),t}function p(e,n){var i={width:n.railXWidth};n.isRtl?i.left=n.negativeScrollAdjustment+e.scrollLeft+n.containerWidth-n.contentWidth:i.left=e.scrollLeft,n.isScrollbarXUsingBottom?i.bottom=n.scrollbarXBottom-e.scrollTop:i.top=n.scrollbarXTop+e.scrollTop,t(n.scrollbarXRail,i);var r={top:e.scrollTop,height:n.railYHeight};n.isScrollbarYUsingRight?n.isRtl?r.right=n.contentWidth-(n.negativeScrollAdjustment+e.scrollLeft)-n.scrollbarYRight-n.scrollbarYOuterWidth:r.right=n.scrollbarYRight-e.scrollLeft:n.isRtl?r.left=n.negativeScrollAdjustment+e.scrollLeft+2*n.containerWidth-n.contentWidth-n.scrollbarYLeft-n.scrollbarYOuterWidth:r.left=n.scrollbarYLeft+e.scrollLeft,t(n.scrollbarYRail,r),t(n.scrollbarX,{left:n.scrollbarXLeft,width:n.scrollbarXWidth-n.railBorderXWidth}),t(n.scrollbarY,{top:n.scrollbarYTop,height:n.scrollbarYHeight-n.railBorderYWidth})}function g(e,t){function n(t){g[u]=f+b*(t[l]-v),a(e,p),M(e),t.stopPropagation(),t.preventDefault()}function i(){s(e,p),e.event.unbind(e.ownerDocument,"mousemove",n)}var r=t[0],o=t[1],l=t[2],c=t[3],d=t[4],h=t[5],u=t[6],p=t[7],g=e.element,f=null,v=null,b=null;e.event.bind(e[d],"mousedown",(function(t){f=g[u],v=t[l],b=(e[o]-e[r])/(e[c]-e[h]),e.event.bind(e.ownerDocument,"mousemove",n),e.event.once(e.ownerDocument,"mouseup",i),t.stopPropagation(),t.preventDefault()}))}var f=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector,v={main:"ps",element:{thumb:function(e){return"ps__thumb-"+e},rail:function(e){return"ps__rail-"+e},consuming:"ps__child--consume"},state:{focus:"ps--focus",active:function(e){return"ps--active-"+e},scrolling:function(e){return"ps--scrolling-"+e}}},b={x:null,y:null},m=function(e){this.element=e,this.handlers={}},y={isEmpty:{configurable:!0}};m.prototype.bind=function(e,t){void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t),this.element.addEventListener(e,t,!1)},m.prototype.unbind=function(e,t){var n=this;this.handlers[e]=this.handlers[e].filter((function(i){return!(!t||i===t)||(n.element.removeEventListener(e,i,!1),!1)}))},m.prototype.unbindAll=function(){for(var e in this.handlers)this.unbind(e)},y.isEmpty.get=function(){var e=this;return Object.keys(this.handlers).every((function(t){return 0===e.handlers[t].length}))},Object.defineProperties(m.prototype,y);var w=function(){this.eventElements=[]};w.prototype.eventElement=function(e){var t=this.eventElements.filter((function(t){return t.element===e}))[0];return t||(t=new m(e),this.eventElements.push(t)),t},w.prototype.bind=function(e,t,n){this.eventElement(e).bind(t,n)},w.prototype.unbind=function(e,t,n){var i=this.eventElement(e);i.unbind(t,n),i.isEmpty&&this.eventElements.splice(this.eventElements.indexOf(i),1)},w.prototype.unbindAll=function(){this.eventElements.forEach((function(e){return e.unbindAll()})),this.eventElements=[]},w.prototype.once=function(e,t,n){var i=this.eventElement(e);i.bind(t,(function e(r){i.unbind(t,e),n(r)}))};var S=function(e,t,n,i,r){var o;if(void 0===i&&(i=!0),void 0===r&&(r=!1),"top"===t)o=["contentHeight","containerHeight","scrollTop","y","up","down"];else{if("left"!==t)throw new Error("A proper axis should be provided");o=["contentWidth","containerWidth","scrollLeft","x","left","right"]}!function(e,t,n,i,r){var o=n[0],a=n[1],s=n[2],d=n[3],h=n[4],u=n[5];void 0===i&&(i=!0),void 0===r&&(r=!1);var p=e.element;e.reach[d]=null,p[s]<1&&(e.reach[d]="start"),p[s]>e[o]-e[a]-1&&(e.reach[d]="end"),t&&(p.dispatchEvent(c("ps-scroll-"+d)),t<0?p.dispatchEvent(c("ps-scroll-"+h)):t>0&&p.dispatchEvent(c("ps-scroll-"+u)),i&&l(e,d)),e.reach[d]&&(t||r)&&p.dispatchEvent(c("ps-"+d+"-reach-"+e.reach[d]))}(e,n,o,i,r)},k={isWebKit:document&&"WebkitAppearance"in document.documentElement.style,supportsTouch:window&&("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),supportsIePointer:navigator&&navigator.msMaxTouchPoints},M=function(e){var t=e.element;e.containerWidth=t.clientWidth,e.containerHeight=t.clientHeight,e.contentWidth=t.scrollWidth,e.contentHeight=t.scrollHeight,t.contains(e.scrollbarXRail)||(o(t,v.element.rail("x")).forEach((function(e){return r(e)})),t.appendChild(e.scrollbarXRail)),t.contains(e.scrollbarYRail)||(o(t,v.element.rail("y")).forEach((function(e){return r(e)})),t.appendChild(e.scrollbarYRail)),!e.settings.suppressScrollX&&e.containerWidth+e.settings.scrollXMarginOffset<e.contentWidth?(e.scrollbarXActive=!0,e.railXWidth=e.containerWidth-e.railXMarginWidth,e.railXRatio=e.containerWidth/e.railXWidth,e.scrollbarXWidth=u(e,d(e.railXWidth*e.containerWidth/e.contentWidth)),e.scrollbarXLeft=d((e.negativeScrollAdjustment+t.scrollLeft)*(e.railXWidth-e.scrollbarXWidth)/(e.contentWidth-e.containerWidth))):e.scrollbarXActive=!1,!e.settings.suppressScrollY&&e.containerHeight+e.settings.scrollYMarginOffset<e.contentHeight?(e.scrollbarYActive=!0,e.railYHeight=e.containerHeight-e.railYMarginHeight,e.railYRatio=e.containerHeight/e.railYHeight,e.scrollbarYHeight=u(e,d(e.railYHeight*e.containerHeight/e.contentHeight)),e.scrollbarYTop=d(t.scrollTop*(e.railYHeight-e.scrollbarYHeight)/(e.contentHeight-e.containerHeight))):e.scrollbarYActive=!1,e.scrollbarXLeft>=e.railXWidth-e.scrollbarXWidth&&(e.scrollbarXLeft=e.railXWidth-e.scrollbarXWidth),e.scrollbarYTop>=e.railYHeight-e.scrollbarYHeight&&(e.scrollbarYTop=e.railYHeight-e.scrollbarYHeight),p(t,e),e.scrollbarXActive?t.classList.add(v.state.active("x")):(t.classList.remove(v.state.active("x")),e.scrollbarXWidth=0,e.scrollbarXLeft=0,t.scrollLeft=0),e.scrollbarYActive?t.classList.add(v.state.active("y")):(t.classList.remove(v.state.active("y")),e.scrollbarYHeight=0,e.scrollbarYTop=0,t.scrollTop=0)},Y={"click-rail":function(e){e.event.bind(e.scrollbarY,"mousedown",(function(e){return e.stopPropagation()})),e.event.bind(e.scrollbarYRail,"mousedown",(function(t){var n=t.pageY-window.pageYOffset-e.scrollbarYRail.getBoundingClientRect().top>e.scrollbarYTop?1:-1;e.element.scrollTop+=n*e.containerHeight,M(e),t.stopPropagation()})),e.event.bind(e.scrollbarX,"mousedown",(function(e){return e.stopPropagation()})),e.event.bind(e.scrollbarXRail,"mousedown",(function(t){var n=t.pageX-window.pageXOffset-e.scrollbarXRail.getBoundingClientRect().left>e.scrollbarXLeft?1:-1;e.element.scrollLeft+=n*e.containerWidth,M(e),t.stopPropagation()}))},"drag-thumb":function(e){g(e,["containerWidth","contentWidth","pageX","railXWidth","scrollbarX","scrollbarXWidth","scrollLeft","x"]),g(e,["containerHeight","contentHeight","pageY","railYHeight","scrollbarY","scrollbarYHeight","scrollTop","y"])},keyboard:function(e){var t=e.element,n=function(){return i(t,":hover")},r=function(){return i(e.scrollbarX,":focus")||i(e.scrollbarY,":focus")};e.event.bind(e.ownerDocument,"keydown",(function(i){if(!(i.isDefaultPrevented&&i.isDefaultPrevented()||i.defaultPrevented)&&(n()||r())){var o=document.activeElement?document.activeElement:e.ownerDocument.activeElement;if(o){if("IFRAME"===o.tagName)o=o.contentDocument.activeElement;else for(;o.shadowRoot;)o=o.shadowRoot.activeElement;if(h(o))return}var a=0,s=0;switch(i.which){case 37:a=i.metaKey?-e.contentWidth:i.altKey?-e.containerWidth:-30;break;case 38:s=i.metaKey?e.contentHeight:i.altKey?e.containerHeight:30;break;case 39:a=i.metaKey?e.contentWidth:i.altKey?e.containerWidth:30;break;case 40:s=i.metaKey?-e.contentHeight:i.altKey?-e.containerHeight:-30;break;case 32:s=i.shiftKey?e.containerHeight:-e.containerHeight;break;case 33:s=e.containerHeight;break;case 34:s=-e.containerHeight;break;case 36:s=e.contentHeight;break;case 35:s=-e.contentHeight;break;default:return}e.settings.suppressScrollX&&0!==a||e.settings.suppressScrollY&&0!==s||(t.scrollTop-=s,t.scrollLeft+=a,M(e),function(n,i){var r=t.scrollTop;if(0===n){if(!e.scrollbarYActive)return!1;if(0===r&&i>0||r>=e.contentHeight-e.containerHeight&&i<0)return!e.settings.wheelPropagation}var o=t.scrollLeft;if(0===i){if(!e.scrollbarXActive)return!1;if(0===o&&n<0||o>=e.contentWidth-e.containerWidth&&n>0)return!e.settings.wheelPropagation}return!0}(a,s)&&i.preventDefault())}}))},wheel:function(t){function n(t,n,i){if(!k.isWebKit&&r.querySelector("select:focus"))return!0;if(!r.contains(t))return!1;for(var o=t;o&&o!==r;){if(o.classList.contains(v.element.consuming))return!0;var a=e(o);if([a.overflow,a.overflowX,a.overflowY].join("").match(/(scroll|auto)/)){var s=o.scrollHeight-o.clientHeight;if(s>0&&!(0===o.scrollTop&&i>0||o.scrollTop===s&&i<0))return!0;var l=o.scrollLeft-o.clientWidth;if(l>0&&!(0===o.scrollLeft&&n<0||o.scrollLeft===l&&n>0))return!0}o=o.parentNode}return!1}function i(e){var i=function(e){var t=e.deltaX,n=-1*e.deltaY;return void 0!==t&&void 0!==n||(t=-1*e.wheelDeltaX/6,n=e.wheelDeltaY/6),e.deltaMode&&1===e.deltaMode&&(t*=10,n*=10),t!=t&&n!=n&&(t=0,n=e.wheelDelta),e.shiftKey?[-n,-t]:[t,n]}(e),o=i[0],a=i[1];if(!n(e.target,o,a)){var s=!1;t.settings.useBothWheelAxes?t.scrollbarYActive&&!t.scrollbarXActive?(a?r.scrollTop-=a*t.settings.wheelSpeed:r.scrollTop+=o*t.settings.wheelSpeed,s=!0):t.scrollbarXActive&&!t.scrollbarYActive&&(o?r.scrollLeft+=o*t.settings.wheelSpeed:r.scrollLeft-=a*t.settings.wheelSpeed,s=!0):(r.scrollTop-=a*t.settings.wheelSpeed,r.scrollLeft+=o*t.settings.wheelSpeed),M(t),(s=s||function(e,n){var i=r.scrollTop;if(0===e){if(!t.scrollbarYActive)return!1;if(0===i&&n>0||i>=t.contentHeight-t.containerHeight&&n<0)return!t.settings.wheelPropagation}var o=r.scrollLeft;if(0===n){if(!t.scrollbarXActive)return!1;if(0===o&&e<0||o>=t.contentWidth-t.containerWidth&&e>0)return!t.settings.wheelPropagation}return!0}(o,a))&&!e.ctrlKey&&(e.stopPropagation(),e.preventDefault())}}var r=t.element;void 0!==window.onwheel?t.event.bind(r,"wheel",i):void 0!==window.onmousewheel&&t.event.bind(r,"mousewheel",i)},touch:function(e){function t(t,n){var i=d.scrollTop,r=d.scrollLeft,o=Math.abs(t),a=Math.abs(n);if(a>o){if(n<0&&i===e.contentHeight-e.containerHeight||n>0&&0===i)return{stop:!e.settings.swipePropagation,prevent:0===window.scrollY}}else if(o>a&&(t<0&&r===e.contentWidth-e.containerWidth||t>0&&0===r))return{stop:!e.settings.swipePropagation,prevent:!0};return{stop:!0,prevent:!0}}function n(t,n){d.scrollTop-=n,d.scrollLeft-=t,M(e)}function i(){f=!0}function r(){f=!1}function o(e){return e.targetTouches?e.targetTouches[0]:e}function a(e){return!(e.pointerType&&"pen"===e.pointerType&&0===e.buttons||(!e.targetTouches||1!==e.targetTouches.length)&&(!e.pointerType||"mouse"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE))}function s(e){if(a(e)){v=!0;var t=o(e);h.pageX=t.pageX,h.pageY=t.pageY,u=(new Date).getTime(),null!==g&&clearInterval(g),e.stopPropagation()}}function l(i){if(!v&&e.settings.swipePropagation&&s(i),!f&&v&&a(i)){var r=o(i),l={pageX:r.pageX,pageY:r.pageY},c=l.pageX-h.pageX,d=l.pageY-h.pageY;n(c,d),h=l;var g=(new Date).getTime(),b=g-u;b>0&&(p.x=c/b,p.y=d/b,u=g);var m=t(c,d),y=m.stop,w=m.prevent;y&&i.stopPropagation(),w&&i.preventDefault()}}function c(){!f&&v&&(v=!1,e.settings.swipeEasing&&(clearInterval(g),g=setInterval((function(){e.isInitialized?clearInterval(g):p.x||p.y?Math.abs(p.x)<.01&&Math.abs(p.y)<.01?clearInterval(g):(n(30*p.x,30*p.y),p.x*=.8,p.y*=.8):clearInterval(g)}),10)))}if(k.supportsTouch||k.supportsIePointer){var d=e.element,h={},u=0,p={},g=null,f=!1,v=!1;k.supportsTouch?(e.event.bind(window,"touchstart",i),e.event.bind(window,"touchend",r),e.event.bind(d,"touchstart",s),e.event.bind(d,"touchmove",l),e.event.bind(d,"touchend",c)):k.supportsIePointer&&(window.PointerEvent?(e.event.bind(window,"pointerdown",i),e.event.bind(window,"pointerup",r),e.event.bind(d,"pointerdown",s),e.event.bind(d,"pointermove",l),e.event.bind(d,"pointerup",c)):window.MSPointerEvent&&(e.event.bind(window,"MSPointerDown",i),e.event.bind(window,"MSPointerUp",r),e.event.bind(d,"MSPointerDown",s),e.event.bind(d,"MSPointerMove",l),e.event.bind(d,"MSPointerUp",c)))}}},T=function(i,r){var o=this;if(void 0===r&&(r={}),"string"==typeof i&&(i=document.querySelector(i)),!i||!i.nodeName)throw new Error("no element is specified to initialize PerfectScrollbar");for(var a in this.element=i,i.classList.add(v.main),this.settings={handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollingThreshold:1e3,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,swipeEasing:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1},r)o.settings[a]=r[a];this.containerWidth=null,this.containerHeight=null,this.contentWidth=null,this.contentHeight=null;var s=function(){return i.classList.add(v.state.focus)},l=function(){return i.classList.remove(v.state.focus)};this.isRtl="rtl"===e(i).direction,this.isNegativeScroll=function(){var e,t=i.scrollLeft;return i.scrollLeft=-1,e=i.scrollLeft<0,i.scrollLeft=t,e}(),this.negativeScrollAdjustment=this.isNegativeScroll?i.scrollWidth-i.clientWidth:0,this.event=new w,this.ownerDocument=i.ownerDocument||document,this.scrollbarXRail=n(v.element.rail("x")),i.appendChild(this.scrollbarXRail),this.scrollbarX=n(v.element.thumb("x")),this.scrollbarXRail.appendChild(this.scrollbarX),this.scrollbarX.setAttribute("tabindex",0),this.event.bind(this.scrollbarX,"focus",s),this.event.bind(this.scrollbarX,"blur",l),this.scrollbarXActive=null,this.scrollbarXWidth=null,this.scrollbarXLeft=null;var c=e(this.scrollbarXRail);this.scrollbarXBottom=parseInt(c.bottom,10),isNaN(this.scrollbarXBottom)?(this.isScrollbarXUsingBottom=!1,this.scrollbarXTop=d(c.top)):this.isScrollbarXUsingBottom=!0,this.railBorderXWidth=d(c.borderLeftWidth)+d(c.borderRightWidth),t(this.scrollbarXRail,{display:"block"}),this.railXMarginWidth=d(c.marginLeft)+d(c.marginRight),t(this.scrollbarXRail,{display:""}),this.railXWidth=null,this.railXRatio=null,this.scrollbarYRail=n(v.element.rail("y")),i.appendChild(this.scrollbarYRail),this.scrollbarY=n(v.element.thumb("y")),this.scrollbarYRail.appendChild(this.scrollbarY),this.scrollbarY.setAttribute("tabindex",0),this.event.bind(this.scrollbarY,"focus",s),this.event.bind(this.scrollbarY,"blur",l),this.scrollbarYActive=null,this.scrollbarYHeight=null,this.scrollbarYTop=null;var h=e(this.scrollbarYRail);this.scrollbarYRight=parseInt(h.right,10),isNaN(this.scrollbarYRight)?(this.isScrollbarYUsingRight=!1,this.scrollbarYLeft=d(h.left)):this.isScrollbarYUsingRight=!0,this.scrollbarYOuterWidth=this.isRtl?function(t){var n=e(t);return d(n.width)+d(n.paddingLeft)+d(n.paddingRight)+d(n.borderLeftWidth)+d(n.borderRightWidth)}(this.scrollbarY):null,this.railBorderYWidth=d(h.borderTopWidth)+d(h.borderBottomWidth),t(this.scrollbarYRail,{display:"block"}),this.railYMarginHeight=d(h.marginTop)+d(h.marginBottom),t(this.scrollbarYRail,{display:""}),this.railYHeight=null,this.railYRatio=null,this.reach={x:i.scrollLeft<=0?"start":i.scrollLeft>=this.contentWidth-this.containerWidth?"end":null,y:i.scrollTop<=0?"start":i.scrollTop>=this.contentHeight-this.containerHeight?"end":null},this.isAlive=!0,this.settings.handlers.forEach((function(e){return Y[e](o)})),this.lastScrollTop=i.scrollTop,this.lastScrollLeft=i.scrollLeft,this.event.bind(this.element,"scroll",(function(e){return o.onScroll(e)})),M(this)};return T.prototype.update=function(){this.isAlive&&(this.negativeScrollAdjustment=this.isNegativeScroll?this.element.scrollWidth-this.element.clientWidth:0,t(this.scrollbarXRail,{display:"block"}),t(this.scrollbarYRail,{display:"block"}),this.railXMarginWidth=d(e(this.scrollbarXRail).marginLeft)+d(e(this.scrollbarXRail).marginRight),this.railYMarginHeight=d(e(this.scrollbarYRail).marginTop)+d(e(this.scrollbarYRail).marginBottom),t(this.scrollbarXRail,{display:"none"}),t(this.scrollbarYRail,{display:"none"}),M(this),S(this,"top",0,!1,!0),S(this,"left",0,!1,!0),t(this.scrollbarXRail,{display:""}),t(this.scrollbarYRail,{display:""}))},T.prototype.onScroll=function(e){this.isAlive&&(M(this),S(this,"top",this.element.scrollTop-this.lastScrollTop),S(this,"left",this.element.scrollLeft-this.lastScrollLeft),this.lastScrollTop=this.element.scrollTop,this.lastScrollLeft=this.element.scrollLeft)},T.prototype.destroy=function(){this.isAlive&&(this.event.unbindAll(),r(this.scrollbarX),r(this.scrollbarY),r(this.scrollbarXRail),r(this.scrollbarYRail),this.removePsClasses(),this.element=null,this.scrollbarX=null,this.scrollbarY=null,this.scrollbarXRail=null,this.scrollbarYRail=null,this.isAlive=!1)},T.prototype.removePsClasses=function(){this.element.className=this.element.className.split(" ").filter((function(e){return!e.match(/^ps([-_].+|)$/)})).join(" ")},T}))},function(e,t){var n,i,r,o;n=jQuery,i=10,r=.95,o={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,t){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+t.color+";'>"+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}},n.plot.plugins.push({init:function(e){var t=null,o=null,a=null,s=null,l=null,c=null,d=!1,h=null,u=[];function p(e,i,r){d||(d=!0,t=e.getCanvas(),o=n(t).parent(),a=e.getOptions(),e.setData(function(e){for(var t=0,i=0,r=0,o=a.series.pie.combine.color,s=[],l=0;l<e.length;++l){var c=e[l].data;n.isArray(c)&&1==c.length&&(c=c[0]),n.isArray(c)?!isNaN(parseFloat(c[1]))&&isFinite(c[1])?c[1]=+c[1]:c[1]=0:c=!isNaN(parseFloat(c))&&isFinite(c)?[1,+c]:[1,0],e[l].data=[c]}for(l=0;l<e.length;++l)t+=e[l].data[0][1];for(l=0;l<e.length;++l)(c=e[l].data[0][1])/t<=a.series.pie.combine.threshold&&(i+=c,r++,o||(o=e[l].color));for(l=0;l<e.length;++l)c=e[l].data[0][1],(r<2||c/t>a.series.pie.combine.threshold)&&s.push(n.extend(e[l],{data:[[1,c]],color:e[l].color,label:e[l].label,angle:c*Math.PI*2/t,percent:c/(t/100)}));return r>1&&s.push({data:[[1,i]],color:o,label:a.series.pie.combine.label,angle:i*Math.PI*2/t,percent:i/(t/100)}),s}(e.getData())))}function g(e,t){if(o){var u=e.getPlaceholder().width(),p=e.getPlaceholder().height(),g=o.children().filter(".legend").children().width()||0;h=t,d=!1,s=Math.min(u,p/a.series.pie.tilt)/2,c=p/2+a.series.pie.offset.top,l=u/2,"auto"==a.series.pie.offset.left?(a.legend.position.match("w")?l+=g/2:l-=g/2,l<s?l=s:l>u-s&&(l=u-s)):l+=a.series.pie.offset.left;var v=e.getData(),b=0;do{b>0&&(s*=r),b+=1,m(),a.series.pie.tilt<=.8&&y()}while(!w()&&b<i);b>=i&&(m(),o.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),e.setSeries&&e.insertLegend&&(e.setSeries(v),e.insertLegend())}function m(){h.clearRect(0,0,u,p),o.children().filter(".pieLabel, .pieLabelBackground").remove()}function y(){var e=a.series.pie.shadow.left,t=a.series.pie.shadow.top,n=a.series.pie.shadow.alpha,i=a.series.pie.radius>1?a.series.pie.radius:s*a.series.pie.radius;if(!(i>=u/2-e||i*a.series.pie.tilt>=p/2-t||i<=10)){h.save(),h.translate(e,t),h.globalAlpha=n,h.fillStyle="#000",h.translate(l,c),h.scale(1,a.series.pie.tilt);for(var r=1;r<=10;r++)h.beginPath(),h.arc(0,0,i,0,2*Math.PI,!1),h.fill(),i-=r;h.restore()}}function w(){var e=Math.PI*a.series.pie.startAngle,t=a.series.pie.radius>1?a.series.pie.radius:s*a.series.pie.radius;h.save(),h.translate(l,c),h.scale(1,a.series.pie.tilt),h.save();for(var i=e,r=0;r<v.length;++r)v[r].startAngle=i,d(v[r].angle,v[r].color,!0);if(h.restore(),a.series.pie.stroke.width>0){for(h.save(),h.lineWidth=a.series.pie.stroke.width,i=e,r=0;r<v.length;++r)d(v[r].angle,a.series.pie.stroke.color,!1);h.restore()}return f(h),h.restore(),!a.series.pie.label.show||function(){for(var t=e,i=a.series.pie.label.radius>1?a.series.pie.label.radius:s*a.series.pie.label.radius,r=0;r<v.length;++r){if(v[r].percent>=100*a.series.pie.label.threshold&&!d(v[r],t,r))return!1;t+=v[r].angle}return!0;function d(e,t,r){if(0==e.data[0][1])return!0;var s,d=a.legend.labelFormatter,h=a.series.pie.label.formatter;s=d?d(e.label,e):e.label,h&&(s=h(s,e));var g=(t+e.angle+t)/2,f=l+Math.round(Math.cos(g)*i),v=c+Math.round(Math.sin(g)*i)*a.series.pie.tilt,b="<span class='pieLabel' id='pieLabel"+r+"' style='position:absolute;top:"+v+"px;left:"+f+"px;'>"+s+"</span>";o.append(b);var m=o.children("#pieLabel"+r),y=v-m.height()/2,w=f-m.width()/2;if(m.css("top",y),m.css("left",w),0-y>0||0-w>0||p-(y+m.height())<0||u-(w+m.width())<0)return!1;if(0!=a.series.pie.label.background.opacity){var S=a.series.pie.label.background.color;null==S&&(S=e.color);var k="top:"+y+"px;left:"+w+"px;";n("<div class='pieLabelBackground' style='position:absolute;width:"+m.width()+"px;height:"+m.height()+"px;"+k+"background-color:"+S+";'></div>").css("opacity",a.series.pie.label.background.opacity).insertBefore(m)}return!0}}();function d(e,n,r){e<=0||isNaN(e)||(r?h.fillStyle=n:(h.strokeStyle=n,h.lineJoin="round"),h.beginPath(),Math.abs(e-2*Math.PI)>1e-9&&h.moveTo(0,0),h.arc(0,0,t,i,i+e/2,!1),h.arc(0,0,t,i+e/2,i+e,!1),h.closePath(),i+=e,r?h.fill():h.stroke())}}}function f(e){if(a.series.pie.innerRadius>0){e.save();var t=a.series.pie.innerRadius>1?a.series.pie.innerRadius:s*a.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=a.series.pie.stroke.color,e.arc(0,0,t,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=a.series.pie.stroke.color,e.arc(0,0,t,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function v(e,t){for(var n=!1,i=-1,r=e.length,o=r-1;++i<r;o=i)(e[i][1]<=t[1]&&t[1]<e[o][1]||e[o][1]<=t[1]&&t[1]<e[i][1])&&t[0]<(e[o][0]-e[i][0])*(t[1]-e[i][1])/(e[o][1]-e[i][1])+e[i][0]&&(n=!n);return n}function b(e){y("plothover",e)}function m(e){y("plotclick",e)}function y(t,n){var i=e.offset(),r=function(t,n){for(var i,r,o=e.getData(),a=e.getOptions(),d=a.series.pie.radius>1?a.series.pie.radius:s*a.series.pie.radius,u=0;u<o.length;++u){var p=o[u];if(p.pie.show){if(h.save(),h.beginPath(),h.moveTo(0,0),h.arc(0,0,d,p.startAngle,p.startAngle+p.angle/2,!1),h.arc(0,0,d,p.startAngle+p.angle/2,p.startAngle+p.angle,!1),h.closePath(),i=t-l,r=n-c,h.isPointInPath){if(h.isPointInPath(t-l,n-c))return h.restore(),{datapoint:[p.percent,p.data],dataIndex:0,series:p,seriesIndex:u}}else if(v([[0,0],[d*Math.cos(p.startAngle),d*Math.sin(p.startAngle)],[d*Math.cos(p.startAngle+p.angle/4),d*Math.sin(p.startAngle+p.angle/4)],[d*Math.cos(p.startAngle+p.angle/2),d*Math.sin(p.startAngle+p.angle/2)],[d*Math.cos(p.startAngle+p.angle/1.5),d*Math.sin(p.startAngle+p.angle/1.5)],[d*Math.cos(p.startAngle+p.angle),d*Math.sin(p.startAngle+p.angle)]],[i,r]))return h.restore(),{datapoint:[p.percent,p.data],dataIndex:0,series:p,seriesIndex:u};h.restore()}}return null}(parseInt(n.pageX-i.left),parseInt(n.pageY-i.top));if(a.grid.autoHighlight)for(var d=0;d<u.length;++d){var p=u[d];p.auto!=t||r&&p.series==r.series||w(p.series)}r&&function(t,n){var i=S(t);-1==i?(u.push({series:t,auto:n}),e.triggerRedrawOverlay()):n||(u[i].auto=!1)}(r.series,t);var g={pageX:n.pageX,pageY:n.pageY};o.trigger(t,[g,r])}function w(t){null==t&&(u=[],e.triggerRedrawOverlay());var n=S(t);-1!=n&&(u.splice(n,1),e.triggerRedrawOverlay())}function S(e){for(var t=0;t<u.length;++t)if(u[t].series==e)return t;return-1}e.hooks.processOptions.push((function(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),t.series.pie.tilt>1?t.series.pie.tilt=1:t.series.pie.tilt<0&&(t.series.pie.tilt=0))})),e.hooks.bindEvents.push((function(e,t){var n=e.getOptions();n.series.pie.show&&(n.grid.hoverable&&t.unbind("mousemove").mousemove(b),n.grid.clickable&&t.unbind("click").click(m))})),e.hooks.processDatapoints.push((function(e,t,n,i){e.getOptions().series.pie.show&&p(e)})),e.hooks.drawOverlay.push((function(e,t){e.getOptions().series.pie.show&&function(e,t){var n,i=e.getOptions(),r=i.series.pie.radius>1?i.series.pie.radius:s*i.series.pie.radius;t.save(),t.translate(l,c),t.scale(1,i.series.pie.tilt);for(var o=0;o<u.length;++o)(n=u[o].series).angle<=0||isNaN(n.angle)||(t.fillStyle="rgba(255, 255, 255, "+i.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(n.angle-2*Math.PI)>1e-9&&t.moveTo(0,0),t.arc(0,0,r,n.startAngle,n.startAngle+n.angle/2,!1),t.arc(0,0,r,n.startAngle+n.angle/2,n.startAngle+n.angle,!1),t.closePath(),t.fill());f(t),t.restore()}(e,t)})),e.hooks.draw.push((function(e,t){e.getOptions().series.pie.show&&g(e,t)}))},options:o,name:"pie",version:"1.1"})},function(e,t){!function(e){function t(e,t){return t*Math.floor(e/t)}function n(e,t,n,i){if("function"==typeof e.strftime)return e.strftime(t);var r,o=function(e,t){return t=""+(null==t?"0":t),1==(e=""+e).length?t+e:e},a=[],s=!1,l=e.getHours(),c=l<12;null==n&&(n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),null==i&&(i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),r=l>12?l-12:0==l?12:l;for(var d=0;d<t.length;++d){var h=t.charAt(d);if(s){switch(h){case"a":h=""+i[e.getDay()];break;case"b":h=""+n[e.getMonth()];break;case"d":h=o(e.getDate());break;case"e":h=o(e.getDate()," ");break;case"h":case"H":h=o(l);break;case"I":h=o(r);break;case"l":h=o(r," ");break;case"m":h=o(e.getMonth()+1);break;case"M":h=o(e.getMinutes());break;case"q":h=""+(Math.floor(e.getMonth()/3)+1);break;case"S":h=o(e.getSeconds());break;case"y":h=o(e.getFullYear()%100);break;case"Y":h=""+e.getFullYear();break;case"p":h=c?"am":"pm";break;case"P":h=c?"AM":"PM";break;case"w":h=""+e.getDay()}a.push(h),s=!1}else"%"==h?s=!0:a.push(h)}return a.join("")}function i(e){function t(e,t,n,i){e[t]=function(){return n[i].apply(n,arguments)}}var n={date:e};null!=e.strftime&&t(n,"strftime",e,"strftime"),t(n,"getTime",e,"getTime"),t(n,"setTime",e,"setTime");for(var i=["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds"],r=0;r<i.length;r++)t(n,"get"+i[r],e,"getUTC"+i[r]),t(n,"set"+i[r],e,"setUTC"+i[r]);return n}function r(e,t){if("browser"==t.timezone)return new Date(e);if(t.timezone&&"utc"!=t.timezone){if("undefined"!=typeof timezoneJS&&void 0!==timezoneJS.Date){var n=new timezoneJS.Date;return n.setTimezone(t.timezone),n.setTime(e),n}return i(new Date(e))}return i(new Date(e))}var o={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,quarter:7776e6,year:525949.2*60*1e3},a=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"]],s=a.concat([[3,"month"],[6,"month"],[1,"year"]]),l=a.concat([[1,"quarter"],[2,"quarter"],[1,"year"]]);e.plot.plugins.push({init:function(i){i.hooks.processOptions.push((function(i,a){e.each(i.getAxes(),(function(e,i){var a=i.options;"time"==a.mode&&(i.tickGenerator=function(e){var n=[],i=r(e.min,a),c=0,d=a.tickSize&&"quarter"===a.tickSize[1]||a.minTickSize&&"quarter"===a.minTickSize[1]?l:s;null!=a.minTickSize&&(c="number"==typeof a.tickSize?a.tickSize:a.minTickSize[0]*o[a.minTickSize[1]]);for(var h=0;h<d.length-1&&!(e.delta<(d[h][0]*o[d[h][1]]+d[h+1][0]*o[d[h+1][1]])/2&&d[h][0]*o[d[h][1]]>=c);++h);var u=d[h][0],p=d[h][1];if("year"==p){if(null!=a.minTickSize&&"year"==a.minTickSize[1])u=Math.floor(a.minTickSize[0]);else{var g=Math.pow(10,Math.floor(Math.log(e.delta/o.year)/Math.LN10)),f=e.delta/o.year/g;u=f<1.5?1:f<3?2:f<7.5?5:10,u*=g}u<1&&(u=1)}e.tickSize=a.tickSize||[u,p];var v=e.tickSize[0];p=e.tickSize[1];var b=v*o[p];"second"==p?i.setSeconds(t(i.getSeconds(),v)):"minute"==p?i.setMinutes(t(i.getMinutes(),v)):"hour"==p?i.setHours(t(i.getHours(),v)):"month"==p?i.setMonth(t(i.getMonth(),v)):"quarter"==p?i.setMonth(3*t(i.getMonth()/3,v)):"year"==p&&i.setFullYear(t(i.getFullYear(),v)),i.setMilliseconds(0),b>=o.minute&&i.setSeconds(0),b>=o.hour&&i.setMinutes(0),b>=o.day&&i.setHours(0),b>=4*o.day&&i.setDate(1),b>=2*o.month&&i.setMonth(t(i.getMonth(),3)),b>=2*o.quarter&&i.setMonth(t(i.getMonth(),6)),b>=o.year&&i.setMonth(0);var m,y=0,w=Number.NaN;do{if(m=w,w=i.getTime(),n.push(w),"month"==p||"quarter"==p)if(v<1){i.setDate(1);var S=i.getTime();i.setMonth(i.getMonth()+("quarter"==p?3:1));var k=i.getTime();i.setTime(w+y*o.hour+(k-S)*v),y=i.getHours(),i.setHours(0)}else i.setMonth(i.getMonth()+v*("quarter"==p?3:1));else"year"==p?i.setFullYear(i.getFullYear()+v):i.setTime(w+b)}while(w<e.max&&w!=m);return n},i.tickFormatter=function(e,t){var i=r(e,t.options);if(null!=a.timeformat)return n(i,a.timeformat,a.monthNames,a.dayNames);var s=t.options.tickSize&&"quarter"==t.options.tickSize[1]||t.options.minTickSize&&"quarter"==t.options.minTickSize[1],l=t.tickSize[0]*o[t.tickSize[1]],c=t.max-t.min,d=a.twelveHourClock?" %p":"",h=a.twelveHourClock?"%I":"%H";return n(i,l<o.minute?h+":%M:%S"+d:l<o.day?c<2*o.day?h+":%M"+d:"%b %d "+h+":%M"+d:l<o.month?"%b %d":s&&l<o.quarter||!s&&l<o.year?c<o.year?"%b":"%b %Y":s&&l<o.year?c<o.year?"Q%q":"Q%q %Y":"%Y",a.monthNames,a.dayNames)})}))}))},options:{xaxis:{timezone:null,timeformat:null,twelveHourClock:!1,monthNames:null}},name:"time",version:"1.0"}),e.plot.formatDate=n,e.plot.dateGenerator=r}(jQuery)},,,function(e,t,n){"use strict";n.r(t);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var r=n(2),o=n(1),a=n.n(o),s=n(3),l=n.n(s),c=n(4),d=n.n(c),h=(n(7),n(0)),u=n.n(h);function p(e,t,n,i){var r,o=i.panel;function a(){var e,n=t.width(),a=i.height-function(e){if(!i.panel.legend.show||"Right side"===i.panel.legendType||"On graph"===i.panel.legendType)return 20;if("Under graph"===i.panel.legendType&&i.panel.legend.percentage||i.panel.legend.values){var t=parseInt(i.panel.breakPoint,10)/100,n=23+20*r.length;return Math.min(n,Math.floor(e*t))}return 0}(i.height),s=Math.min(n,a),l=(e=(e=u()("body").css("background-color")).match(/^rgb?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2));l=l.startsWith("#f")||l.startsWith("#e")?"#000000":"#ffffff";var c,d,h,p,g=u()("body").css("font-size"),f=u()("<div></div>"),v={margin:"auto",position:"relative",paddingBottom:"20px",height:s+"px"},b={width:"100%",height:a+"px",sankey:{node:{label:{fontName:"Times-Roman",fontSize:g,color:l,bold:!0,italic:!0}}}};f.css(v),r=i.data;for(var m=0;m<r.length;m++){var y=r[m];i.hiddenSeries[y.label]&&(y.data={})}if(o.legend.sort&&(i.panel.valueName!==o.legend.sort&&(o.legend.sort=i.panel.valueName),!0===o.legend.sortDesc?r.sort((function(e,t){return t.legendData-e.legendData})):r.sort((function(e,t){return e.legendData-t.legendData}))),t.html(f),0!==r.length&&0!==Object.keys(r[0]).length){if((h=new google.visualization.DataTable).addColumn("string","From"),h.addColumn("string","To"),h.addColumn("number","Count"),"A-series"===r[0].label)console.log("Adding sample data suitable for Sankey diagram representation"),h.addRows([["AppA","Activity2",10]]),h.addRows([["AppB","Activity1",10]]),h.addRows([["AppB","Activity2",5]]),h.addRows([["Activity1","Scope1",6]]),h.addRows([["Activity2","Scope1",7]]),h.addRows([["Activity1","Scope2",8]]),h.addRows([["Activity2","Scope2",2]]);else for(var w in c={},r.forEach((function(e){d=e.label.split("---");for(var t=0;t<d.length-1;t++)c.hasOwnProperty(d[t]+"---"+d[t+1])?(p=c[d[t]+"---"+d[t+1]].value,c[d[t]+"---"+d[t+1]].value=e.data+p):c[d[t]+"---"+d[t+1]]={source:d[t],target:d[t+1],value:e.data}})),c)h.addRows([[c[w].source,c[w].target,c[w].value]]);new google.visualization.Sankey(t[0]).draw(h,b)}}function s(e){i.data&&(r=i.data,0===i.data.length?t.html('<div class="datapoints-warning"><span class="small">No data points</span></div>'):a(),e&&i.renderingCompleted())}t=t.find(".sankey-panel__chart"),i.events.on("render",(function(){"Right side"===o.legendType?(s(!1),setTimeout((function(){s(!0)}),50)):s(!0)}))}google.charts.load("current",{packages:["sankey"]});var g=n(5),f=n.n(g),v=(n(8),n(6)),b=n.n(v);f.a.module("grafana.directives").directive("sankeyLegend",["popoverSrv","$timeout",function(e,t){return{link:function(n,i){var r,o,s,l,c,d=u()('<div class="sankey-legend__container"></div>'),h=!0,p=n.ctrl,g=p.panel;function f(e){return e.parents("[data-series-index]").data("series-index")}function v(e){var t=f(u()(e.currentTarget)),n=s[t],i=u()(d.children("tbody")).scrollTop();p.toggleSeries(n),void 0!==i&&u()(d.children("tbody")).scrollTop(i)}function m(e){var t=u()(e.currentTarget).data("stat");if(t!==g.legend.sort&&(g.legend.sortDesc=null),!1===g.legend.sortDesc)return g.legend.sort=null,g.legend.sortDesc=null,void p.render();g.legend.sortDesc=!g.legend.sortDesc,g.legend.sort=t,p.render()}function y(n){if(!u()(n.target).parents(".popover").length){var i=u()(n.currentTarget).find(".fa-minus"),r=f(i),a=o[r];t((function(){e.show({element:i[0],position:"right center",template:'<series-color-picker-popover series="series" onToggleAxis="toggleAxis" onColorChange="colorSelected"></series-color-picker-popover>',openOn:"hover",classNames:"drop-popover drop-popover--transparent",model:{autoClose:!0,series:a,toggleAxis:function(){},colorSelected:function(e){p.changeSeriesColor(a,e)}}})}))}}n.$on("$destroy",(function(){c&&c.destroy()})),p.events.on("render",(function(){if(r=p.series){for(var e in r)r[e].color=p.data[e].color;!function(){if(!g.legend.show)return d.empty(),void i.find(".sankey-legend").css("padding-top",0);i.find(".sankey-legend").css("padding-top",6);h&&(i.append(d),d.on("click",".sankey-legend-icon",y),d.on("click",".sankey-legend-alias",v),d.on("click","th",m),h=!1);o=r,s=p.data,d.empty();var e="Right side"===g.legendType&&g.legend.sideWidth?g.legend.sideWidth+"px":"",t="Right side"===g.legendType&&g.legend.sideWidth?g.legend.sideWidth-1+"px":"";i.css("min-width",e),i.css("width",t);var n,f=g.legend.values||g.legend.percentage,w=("Under graph"===g.legendType||"Right side"===g.legendType)&&f;if(d.toggleClass("sankey-legend-table",w),w){var S='<tr><th colspan="2" style="text-align:left"></th>';g.legend.values&&(S+=function(e){var t=e;g.legend.header&&(t=g.legend.header);var n='<th class="pointer" data-stat="'+a.a.escape(e)+'">'+t;if(g.legend.sort===e){var i=g.legend.sortDesc?"fa fa-caret-down":"fa fa-caret-up";n+=' <span class="'+i+'"></span>'}return n+"</th>"}(p.panel.valueName)),g.legend.percentage&&(S+=function(e){var t='<th class="pointer" data-stat="'+e+'">percentage';if(g.legend.sort===e){var n=g.legend.sortDesc?"fa fa-caret-down":"fa fa-caret-up";t+=' <span class="'+n+'"></span>'}return t+"</th>"}(p.panel.valueName)),S+="</tr>",n=u()(S)}var k=0;if(g.legend.percentage)for(l=0;l<o.length;l++)k+=o[l].stats[p.panel.valueName];var M=[];for(l=0;l<o.length;l++){var Y=o[l],T=s[l];if((!g.legend.hideEmpty||!Y.allIsNull)&&Y.legend){var X=0;p.panel.legend.percentageDecimals&&(X=p.panel.legend.percentageDecimals);var W='<div class="sankey-legend-series';if(p.hiddenSeries[T.label]&&(W+=" sankey-legend-series-hidden"),W+='" data-series-index="'+l+'">',W+='<span class="sankey-legend-icon" style="float:none;">',W+='<i class="fa fa-minus pointer" style="color:'+T.color+'"></i>',W+="</span>",W+='<a class="sankey-legend-alias" style="float:none;">'+a.a.escape(T.label)+"</a>",f&&w){var R=T.legendData;if(g.legend.values&&(W+='<div class="sankey-legend-value">'+p.formatValue(R)+"</div>"),k){var A=(R/k*100).toFixed(X)+"%";W+='<div class="sankey-legend-value">'+A+"</div>"}}W+="</div>",M.push(u()(W))}}if(w){var L=u()("<tbody></tbody>");void 0!==n&&L.append(n),L.append(M),d.append(L)}else d.append(M);"Under graph"===g.legendType?c?c.update():c=new b.a(i[0],{scrollYMarginOffset:2,suppressScrollX:!0}):c&&(c.destroy(),c=null)}()}}))}}}]);var m=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;r.$rootScope=i,r.hiddenSeries={};var o={legend:{show:!0,values:!0},links:[],datasource:null,maxDataPoints:3,interval:null,targets:[{}],cacheTimeout:null,nullPointMode:"connected",legendType:"Under graph",breakPoint:"50%",aliasColors:{},format:"short",valueName:"current",strokeWidth:1,fontSize:"80%",combine:{threshold:0,label:"Others"}};return a.a.defaults(r.panel,o),a.a.defaults(r.panel.legend,o.legend),r.events.on("render",r.onRender.bind(r)),r.events.on("data-received",r.onDataReceived.bind(r)),r.events.on("data-error",r.onDataError.bind(r)),r.events.on("data-snapshot-load",r.onDataReceived.bind(r)),r.events.on("init-edit-mode",r.onInitEditMode.bind(r)),r.setLegendWidthForLegacyBrowser(),r}return t.$inject=["$scope","$injector","$rootScope"],function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.onInitEditMode=function(){this.addEditorTab("Options","public/plugins/grafana-sankey-panel/editor.html",2),this.unitFormats=l.a.getUnitFormats()},t.prototype.setUnitFormat=function(e){this.panel.format=e.value,this.render()},t.prototype.onDataError=function(){this.series=[],this.render()},t.prototype.changeSeriesColor=function(e,t){e.color=t,this.panel.aliasColors[e.alias]=e.color,this.render()},t.prototype.onRender=function(){this.data=this.parseSeries(this.series)},t.prototype.parseSeries=function(e){var t=this;return a.a.map(this.series,(function(e,n){return e.alias.split("---").length>=2?{label:e.alias,data:e.stats[t.panel.valueName],color:t.panel.aliasColors[e.alias]||t.$rootScope.colors[n],legendData:e.stats[t.panel.valueName]}:{}}))},t.prototype.onDataReceived=function(e){this.series=e.map(this.seriesHandler.bind(this)),this.data=this.parseSeries(this.series),this.render(this.data)},t.prototype.seriesHandler=function(e){if(e.target&&!a.a.isEmpty(e.target)&&(e.alias=e.target.split(" ").join("---"),e.alias.split("---").length>=2)){var t=new d.a({datapoints:e.datapoints,alias:e.alias});return t.flotpairs=t.getFlotPairs(this.panel.nullPointMode),t}var n=new d.a({datapoints:e.datapoints,alias:e.target});return n.flotpairs=n.getFlotPairs(this.panel.nullPointMode),n},t.prototype.getDecimalsForValue=function(e){if(a.a.isNumber(this.panel.decimals))return{decimals:this.panel.decimals,scaledDecimals:null};var t,n=e/2,i=-Math.floor(Math.log(n)/Math.LN10),r=Math.pow(10,-i),o=n/r;o<1.5?t=1:o<3?(t=2,o>2.25&&(t=2.5,++i)):t=o<7.5?5:10,t*=r,Math.floor(e)===e&&(i=0);var s={decimals:0,scaledDecimals:0};return s.decimals=Math.max(0,i),s.scaledDecimals=s.decimals-Math.floor(Math.log(t)/Math.LN10)+2,s},t.prototype.formatValue=function(e){var t=this.getDecimalsForValue(e),n=l.a.valueFormats[this.panel.format];return n?n(e,t.decimals,t.scaledDecimals):e},t.prototype.link=function(e,t,n,i){p(0,t,0,i)},t.prototype.toggleSeries=function(e){this.hiddenSeries[e.label]?delete this.hiddenSeries[e.label]:this.hiddenSeries[e.label]=!0,this.render()},t.prototype.onLegendTypeChanged=function(){this.setLegendWidthForLegacyBrowser(),this.render()},t.prototype.setLegendWidthForLegacyBrowser=function(){!!window.MSInputMethodContext&&!!document.documentMode&&"Right side"===this.panel.legendType&&!this.panel.legend.sideWidth&&(this.panel.legend.sideWidth=150)},t.templateUrl="module.html",t}(r.MetricsPanelCtrl);n.d(t,"PanelCtrl",(function(){return m})),Object(r.loadPluginCss)({dark:"plugins/grafana-sankey-panel/styles/dark.css",light:"plugins/grafana-sankey-panel/styles/light.css"})}])}));